#!/bin/zsh
#
# @matrix header=a:b:c:d
TEST_MATRIX='
name value some xxx
amas 19
wang   
'
# MAGIC HEADER(F1:F2:...:Fn) DIM(MxN)
MATRIX_MAGIC=@MATRIX
MATRIX_MLEN=$#MATRIX_META

function main() {
    #local content="$(<&0)"
    local content=$TEST_MATRIX
    local vname="matrix"
    local fsep='\n'
    local lsep="\n"
    local -a contents
    local -a header
    contents=(${(f)content})
    header=(${(s: :)contents[1]})
    typeset -ga $vname
    local -i len=$#header 
    

    set -A $vname $MATRIX_MAGIC $len $header
    for line in $contents[2,-1];do
        xs=(${(z)line})
        repeat $((len-$#xs)) { xs+= }
        set -A $vname "${(@P)vname}" "${(@)xs}"
    done
    echo "${(j:,:)matrix}"

    #ismatrix matrix ; echo "IS MATRIX $?"
}

function ismatrix() {
    local vname=$1
    [[ ${(tP)vname} == array ]] && [[ ${${(P)vname}[1]} == $MATRIX_MAGIC ]] && (( ${(P)#vname} >= 3 )) && return 0
    return 1
}

function matrix_new() { }
function matrix_add() { }

main $*
